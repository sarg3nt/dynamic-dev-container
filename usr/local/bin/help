#!/bin/bash
set -euo pipefail
IFS=$'\n\t'

# cSpell:ignore gitui,krew,kustomize,trivy,kubeseal,gping,tldr,kubesec,ncdu,btop,ipython,cmctl,cloc

# The main help file for the dev container.
# This will show the user what tools are installed in the dev container and is ran on shell start.
main() {
  source /usr/bin/lib/sh/colors.sh
  echo -e "${BLUE}********************************************************************"
  echo -e "              Generic Dev Container Tooling v${DEV_CONTAINER_VERSION}"
  echo -e "              Built: $(cat $HOME/build_date.txt)"
  echo -e "********************************************************************${NC}"
  echo -e "${CYAN}Type \"help\" to display this messsage again.${NC}"
  echo -e ""
  echo -e "${GREEN}**** Primary Tools:${NC}"
  echo -e " docker (d), git (g), helm (h), k9s (k), kubectl (kc), packer (p), tofu (tf), vault (v)"
  echo -e ""
  echo -e "${GREEN}**** Utilities:${NC}"
  echo -e " cloc, cmctl, btop, dive, fzf, gitui, go, goreleaser, krew, kube-bench, kustomize, lsd, mise, ncdu, popeye, python 3.13, starship, tldr, trivy, zoxide"
  echo -e ""
  echo -e "${GREEN}**** Installables:${NC}"
  echo -e "${CYAN}To keep the dev container as small as possible, some tools are not installed by default.  Run the below commands to install them.${NC}"
  echo -e " install_powershell, install_powercli"
  echo -e "${CYAN}Use 'mise' to install many other applications.${NC}"
  echo -e " List installable applications: ${BLUE}mise registry${NC}"
  echo -e " Install: ${BLUE}mise use -g argocd@latest${NC}"
  echo -e ""
  echo -e "${GREEN}**** Kubectl Plugins:${NC}"
  echo -e "${CYAN}Invoke a plugin: 'kubectl <plugin>'  List plugins: 'kubectl krew list'${NC}"
  echo -e " access-matrix, blame, ctx (kx), get-all, krew, node-restart, ns (kn), switch-config, view-allocations"
}

# Run main
if ! (return 0 2>/dev/null); then
  (main "$@")
fi
